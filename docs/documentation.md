SoluciÃ³n con Python Puro + ESP32 via USB Serial
Perfecto, haremos todo con Python puro en el backend. El ESP32 se conectarÃ¡ por USB y el backend lo controlarÃ¡ via Serial (PySerial).

ğŸ—ï¸ Arquitectura Simplificada
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App Android   â”‚    POST /api/v1/alerts       â”‚    Backend FastAPI          â”‚
â”‚   (DetecciÃ³n)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                                 â”‚  â”‚    AlertService       â”‚  â”‚
                                                 â”‚  â”‚                       â”‚  â”‚
                                                 â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
                                                 â”‚  â”‚  â”‚  TuyaService    â”‚â”€â”€â”¼â”€â”€â”¼â”€â”€â–¶ ğŸ”” Sirena Tuya
                                                 â”‚  â”‚  â”‚  (tinytuya)     â”‚  â”‚  â”‚    192.168.1.12
                                                 â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
                                                 â”‚  â”‚                       â”‚  â”‚
                                                 â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚  â”‚  â”‚  ESP32Service   â”‚â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â–¶â”‚ ESP32       â”‚
                                                 â”‚  â”‚  â”‚  (PySerial USB) â”‚  â”‚  â”‚    â”‚ USB Serial  â”‚
                                                 â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚ /dev/ttyUSB0â”‚
                                                 â”‚  â”‚                       â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                                                                                      â”‚  LEDs   â”‚
                                                                                      â”‚ ğŸ”´ğŸŸ¡ğŸŸ¢   â”‚
                                                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“ Estructura Final
drowsiness-detecction-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ tuya_service.py         # ğŸ†• Control sirena
â”‚   â”‚   â”œâ”€â”€ esp32_service.py        # ğŸ†• Control LEDs via Serial USB
â”‚   â”‚   â””â”€â”€ alert_service.py        # ğŸ†• Orquestador
â”‚   â”œâ”€â”€ api/v1/routers/
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ users.py
â”‚   â”‚   â””â”€â”€ alerts.py               # ğŸ†• Endpoints de alertas
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ alert.py                # ğŸ†• Schemas
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ alert_event.py          # ğŸ†• Modelo DB (opcional)
â”‚
â”œâ”€â”€ esp32_firmware/                  # ğŸ†• CÃ³digo Arduino para ESP32
â”‚   â””â”€â”€ led_controller.ino          # Firmware simple
â”‚
â””â”€â”€ .env                            # Actualizar con config IoT